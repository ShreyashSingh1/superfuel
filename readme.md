# Math Operations Planner Documentation

## Overview

This system generates and executes plans for mathematical operations based on natural language descriptions. It uses BAML (Boundary AI Markup Language) to create a plan with a sequence of tool calls, then executes those tool calls in order, handling dependencies between operations.

## Components

### 1. Planning Module

The `generate_plan` function takes a natural language paragraph and a list of available tools, then uses a BAML agent to create a structured plan.

```python
def generate_plan(paragraph, tools):
    """Generate a plan with tool calls based on a paragraph and list of tools
    
    Args:
        paragraph (str): The input paragraph text to analyze
        tools (list): List of available tools
        
    Returns:
        dict: A plan with sequence of tool calls
    """
    response = b.AgentPlanner(input={"paragraph": paragraph, "available_tools": tools})
    return response
```

### 2. Execution Module

The `execute_plan` function takes the plan generated by the planner and executes each tool call in sequence, handling dependencies between operations.

```python
def execute_plan(plan):
    """Execute a plan generated by the planner
    
    Args:
        plan: Plan with tool calls (BAML response object)
        
    Returns:
        list: Results of each tool call
    """
```

Key features:
- Tracks intermediate results to handle operation dependencies
- Parses JSON parameters from tool calls
- Handles variable references like `result_of_first_sum`
- Provides detailed error handling

### 3. Math Operations

The system supports four basic math operations:

```python
def execute_tool(tool_name, parameters):
    """Execute a math tool with the given parameters"""
```

Available tools:
- **sum**: Adds two numbers (parameters: a, b)
- **subtract**: Subtracts b from a (parameters: a, b)
- **multiply**: Multiplies two numbers (parameters: a, b)
- **divide**: Divides a by b (parameters: a/b or numerator/denominator)

## Usage Examples

### Basic Operation

```python
paragraph = "i want to multiply 10 by 20"
tools_list = ["sum", "subtract", "multiply", "divide"]
plan = generate_plan(paragraph, tools_list)
results = execute_plan(plan)
```

### Chained Operations

```python
paragraph = "add 20 and 30, then divide it by the sum of 2 and 3"
plan = generate_plan(paragraph, tools_list)
results = execute_plan(plan)
```

### Sequential Operations

```python
paragraph = "multiply 5 by 4, then subtract 3 from the result"
plan = generate_plan(paragraph, tools_list)
results = execute_plan(plan)
```

## Technical Details

### Plan Structure

A plan consists of:
- `plan_description`: A natural language description of the plan
- `tool_calls`: An array of tool calls, each with:
  - `tool_name`: The name of the tool to call
  - `parameters`: JSON string of parameters
  - `purpose`: Explanation of why this tool is called

### Result Structure

Execution results are returned as a list of dictionaries, each containing:
- `tool`: The name of the tool called
- `parameters`: The parameters used (with variables replaced by actual values)
- `result`: The result of the operation
- `status`: "success" or "error"
- `error`: Error message (if status is "error")

### Error Handling

The system handles several types of errors:
- JSON parsing errors in parameters
- Unknown variable references
- Invalid parameters for operations
- Division by zero

## Dependencies

- BAML client for plan generation
- JSON for parameter parsing

## Future Improvements

Potential enhancements:
1. Support for more complex math operations
2. Better handling of variable references in parameters
3. Support for conditional operations
4. Visualization of the execution plan
5. Saving and loading plans
